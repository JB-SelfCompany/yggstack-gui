<div align="center">

# Yggstack-GUI

### Графический интерфейс для пользовательского сетевого стека Yggdrasil

[![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)
[![Go Version](https://img.shields.io/badge/Go-1.22+-00ADD8?logo=go)](https://go.dev/)
[![Yggdrasil](https://img.shields.io/badge/Yggdrasil-Network-green)](https://yggdrasil-network.github.io/)

**Подключение к mesh-сети Yggdrasil без TUN-интерфейса и прав администратора**

**Языки:** [English](README.md) | Русский

[Возможности](#-возможности) • [Установка](#-установка) • [Быстрый старт](#-быстрый-старт) • [Документация](#-документация)

</div>

---

## Обзор

Yggstack-GUI — это кроссплатформенное десктопное приложение, предоставляющее графический интерфейс для [yggstack](https://github.com/yggdrasil-network/yggstack) — пользовательского сетевого стека для mesh-сети Yggdrasil. Приложение позволяет подключаться к Yggdrasil без настройки TUN-интерфейса и без прав администратора.

Приложение работает полностью в пользовательском пространстве, используя netstack от gVisor, что делает его идеальным для:
- Пользователей без прав администратора/root
- Окружений, где TUN-интерфейсы недоступны
- Быстрого подключения без изменения системных сетевых настроек
- Проброса портов и SOCKS5-прокси для доступа к Yggdrasil

---

## Возможности

- **Без TUN-интерфейса** — работает полностью в пользовательском пространстве без модулей ядра
- **Без прав администратора** — не требует root/administrator
- **SOCKS5 прокси** — направляйте трафик любого приложения с поддержкой SOCKS5 через Yggdrasil
- **Проброс портов** — TCP/UDP маппинги между локальной сетью и Yggdrasil
- **Современный интерфейс** — UI на Vue.js с поддержкой тёмной/светлой темы
- **Системный трей** — сворачивание в трей, быстрый доступ к управлению
- **Автозапуск** — запуск при старте системы (в свёрнутом режиме)
- **Управление пирами** — добавление, удаление и мониторинг подключений
- **Статистика трафика** — мониторинг пропускной способности и подключений в реальном времени
- **Кроссплатформенность** — поддержка Windows и Linux

---

## Требования

- **Windows 10/11** или **Linux** (x64)
- Внешние зависимости не требуются

> **Примечание:** В отличие от стандартного демона Yggdrasil, Yggstack-GUI НЕ требует прав администратора или поддержки TUN-интерфейса.

---

## Установка

### Из бинарного файла

Скачайте последний релиз с [GitHub Releases](https://github.com/JB-SelfCompany/yggstack-gui/releases/latest) для вашей платформы.

**Windows:**
```cmd
# Распакуйте архив и запустите
yggstack-gui.exe
```

**Linux:**
```bash
# Распакуйте архив
tar -xzf yggstack-gui-linux-amd64.tar.gz

# Сделайте исполняемым и запустите
chmod +x yggstack-gui
./yggstack-gui
```

### Из исходного кода

**Требования:**
- Go 1.22+
- Node.js 18+
- [Energy CLI](https://energye.github.io/) (CEF-фреймворк)

```bash
# Клонируйте репозиторий
git clone https://github.com/JB-SelfCompany/yggstack-gui.git
cd yggstack-gui

# Установите зависимости фронтенда
cd frontend && npm install && cd ..

# Соберите фронтенд
cd frontend && npm run build && cd ..

# Соберите приложение
go build -o yggstack-gui ./cmd/yggstack-gui
```

---

## Быстрый старт

1. **Запустите приложение**
   ```bash
   ./yggstack-gui
   ```

2. **Добавьте пиры** — перейдите в Настройки и добавьте пиры Yggdrasil (например, из [списка публичных пиров](https://publicpeers.neilalexander.dev/))

3. **Запустите узел** — нажмите "Запустить" на панели управления

4. **Настройте доступ:**
   - **SOCKS5 прокси:** включите на вкладке Прокси, настройте браузер/приложения на использование `127.0.0.1:1080`
   - **Проброс портов:** настройте TCP/UDP маппинги на вкладке Проброс портов

---

## Документация

### Панель управления

Главная панель показывает:
- **Статус узла** — текущее состояние (работает/остановлен)
- **IPv6 адрес** — ваш адрес Yggdrasil (диапазон 200::/7)
- **Подсеть** — ваша подсеть /64 для маршрутизации
- **Публичный ключ** — Ed25519 публичный ключ узла
- **Статистика** — подключённые пиры, сессии, трафик, аптайм

### SOCKS5 прокси

Включите SOCKS5 прокси-сервер для маршрутизации трафика через Yggdrasil:

| Настройка | По умолчанию | Описание |
|-----------|--------------|----------|
| Адрес прослушивания | `127.0.0.1:1080` | Локальный адрес для SOCKS5 сервера |
| DNS-сервер | (опционально) | DNS-сервер для разрешения доменов .ygg |

**Настройка браузера:**
- Firefox: Настройки → Параметры сети → Ручная настройка прокси → SOCKS: `127.0.0.1`, Порт: `1080`
- Chrome: используйте расширения типа SwitchyOmega или системные настройки прокси

### Проброс портов

Поддерживаются четыре типа маппингов:

| Тип | Направление | Применение |
|-----|-------------|------------|
| **Локальный TCP** | Локальный → Yggdrasil | Доступ к сервисам Yggdrasil из локальных приложений |
| **Удалённый TCP** | Yggdrasil → Локальный | Публикация локальных сервисов в сети Yggdrasil |
| **Локальный UDP** | Локальный → Yggdrasil | UDP-трафик в Yggdrasil |
| **Удалённый UDP** | Yggdrasil → Локальный | Приём UDP из Yggdrasil |

**Пример — доступ к SSH на узле Yggdrasil:**
```
Тип: Локальный TCP
Источник: 127.0.0.1:2222
Цель: [200:xxxx::1]:22
```
Затем подключайтесь: `ssh -p 2222 user@127.0.0.1`

**Пример — публикация локального веб-сервера:**
```
Тип: Удалённый TCP
Источник: [ваш-ygg-адрес]:8080
Цель: 127.0.0.1:80
```

### Управление пирами

- **Добавление пиров** — введите URI пиров в стандартном формате Yggdrasil:
  - `tls://hostname:port`
  - `tcp://hostname:port`
  - `quic://hostname:port`

- **Мониторинг пиров** — просмотр статуса подключения, задержки и трафика по каждому пиру

- **Автообнаружение** — multicast-обнаружение пиров в локальной сети (если настроено)

### Настройки

| Настройка | Описание |
|-----------|----------|
| **Тема** | Светлая, Тёмная или Системная |
| **Язык** | Язык интерфейса |
| **Автозапуск** | Запуск при старте системы |
| **Сворачивать в трей** | Кнопка закрытия сворачивает вместо выхода |
| **Адреса прослушивания** | Адреса прослушивания Yggdrasil |

### Системный трей

При сворачивании в трей:
- **Левый клик** — показать/скрыть окно
- **Правый клик** — контекстное меню с быстрыми действиями:
  - Запустить/Остановить узел
  - Показать окно
  - Выход из приложения

---

## Архитектура

```
┌─────────────────────────────────────────────────────┐
│                   Yggstack-GUI                       │
├─────────────────────────────────────────────────────┤
│  Фронтенд (Vue.js + CEF)                            │
│  ├── Панель, Пиры, Прокси, Проброс, Настройки       │
│  └── IPC-коммуникация                               │
├─────────────────────────────────────────────────────┤
│  Бэкенд (Go)                                         │
│  ├── Сервис Yggdrasil (Core + Netstack)             │
│  ├── SOCKS5 прокси-сервер                           │
│  ├── Менеджер проброса портов                       │
│  └── Конфигурация и безопасность (OS Keychain)      │
├─────────────────────────────────────────────────────┤
│  gVisor Netstack                                     │
│  └── TCP/IP стек в userspace (без TUN)              │
└─────────────────────────────────────────────────────┘
```

**Ключевые компоненты:**

- **Energy/CEF** — Chromium Embedded Framework для десктопного UI
- **gVisor Netstack** — реализация сетевого стека в пользовательском пространстве
- **Yggdrasil Core** — mesh-маршрутизация и шифрование
- **IPC Bridge** — коммуникация между фронтендом и бэкендом

---

## Разработка

### Структура проекта

```
yggstack-gui/
├── cmd/yggstack-gui/      # Точка входа приложения
├── internal/
│   ├── app/               # Жизненный цикл приложения, трей
│   ├── config/            # Управление конфигурацией
│   ├── ipc/               # IPC-обработчики и события
│   ├── logger/            # Система логирования
│   ├── platform/          # Платформо-специфичное (автозапуск)
│   ├── security/          # Keychain, криптография, валидация
│   ├── web/               # Встроенные ресурсы фронтенда
│   └── yggdrasil/         # Сервис Yggdrasil, SOCKS, маппинги
│       └── netstack/      # Интеграция gVisor netstack
├── frontend/              # Vue.js фронтенд
│   ├── src/
│   │   ├── components/    # UI-компоненты
│   │   ├── views/         # Страницы
│   │   ├── store/         # Pinia-хранилища
│   │   └── utils/         # IPC-утилиты
│   └── package.json
├── resources/             # Иконки приложения
└── energy-cli/            # Инструменты CEF-фреймворка
```

### Команды сборки

```bash
# Разработка (с hot reload)
YGGSTACK_DEV_URL=http://localhost:5173 go run ./cmd/yggstack-gui
cd frontend && npm run dev

# Продакшн сборка
cd frontend && npm run build
go build -ldflags "-s -w" -o yggstack-gui ./cmd/yggstack-gui

# Запуск тестов
go test -v ./...
```

### Разработка фронтенда

```bash
cd frontend
npm install
npm run dev          # Dev-сервер на localhost:5173
npm run build        # Продакшн сборка
npm run type-check   # Проверка TypeScript
```

---

## Устранение неполадок

<details>
<summary><b>Не удаётся подключиться к пирам</b></summary>

- Проверьте корректность и доступность URI пиров
- Убедитесь, что файрвол разрешает исходящие подключения на порты пиров
- Попробуйте другие пиры из [списка публичных пиров](https://publicpeers.neilalexander.dev/)

</details>

<details>
<summary><b>SOCKS5 прокси не работает</b></summary>

- Убедитесь, что узел Yggdrasil запущен (зелёный статус)
- Проверьте, что прокси включён на вкладке Прокси
- Проверьте адрес прослушивания (по умолчанию: `127.0.0.1:1080`)
- Убедитесь, что приложение настроено на использование SOCKS5 (не HTTP-прокси)

</details>

<details>
<summary><b>Проброс портов не работает</b></summary>

- Проверьте корректность формата адресов источника/цели
- Для удалённых маппингов убедитесь, что Yggdrasil запущен
- Проверьте, не занят ли локальный порт
- Убедитесь, что целевой сервис запущен и доступен

</details>

<details>
<summary><b>Приложение не запускается на Linux</b></summary>

- Установите необходимые библиотеки: `libgtk-3-0`, `libnss3`, `libatk-bridge2.0-0`
- Запустите из терминала, чтобы увидеть сообщения об ошибках
- Проверьте наличие CEF-библиотек в директории приложения

</details>

---

## Лицензия

Проект распространяется под лицензией **GNU General Public License v3.0** — см. файл [LICENSE](LICENSE).

---

## Благодарности

- **Yggdrasil Network** — [yggdrasil-network.github.io](https://yggdrasil-network.github.io/)
- **yggstack** — userspace-реализация Yggdrasil
- **Energy Framework** — [energye.github.io](https://energye.github.io/)
- **gVisor** — сетевой стек в пользовательском пространстве
- **Vue.js** — фронтенд-фреймворк
- **go-socks5** — библиотека SOCKS5-сервера

---

## Поддержка

- **Issues**: [GitHub Issues](https://github.com/JB-SelfCompany/yggstack-gui/issues)
- **Yggdrasil Network**: [yggdrasil-network.github.io](https://yggdrasil-network.github.io/)
- **Публичные пиры**: [publicpeers.neilalexander.dev](https://publicpeers.neilalexander.dev/)

---

<div align="center">

**Сделано с любовью для сообщества Yggdrasil Network**

[Наверх](#yggstack-gui)

</div>
